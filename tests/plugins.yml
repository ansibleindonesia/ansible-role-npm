---

- hosts: localhost
  gather_facts: false

  vars:

    manala_npm_packages:
      - is-positive
      - user-home
      - package: negative-zero
        state: absent
      - package: negative-zero
        state: present

  tasks:

    - set_fact:
        test: "{{ item }}"
      with_manala_npm_packages: "{{ manala_npm_packages }}"
      register: test_results

    # Asserts
    - assert:
        that:
          - "{{
            test_results.results|map(attribute='ansible_facts.test')|sort == [
              {
                'package': 'is-positive'
              },
              {
                'package': 'user-home'
              },
              {
                'package': 'negative-zero',
                'state': 'present'
              }
            ]
          }}"
